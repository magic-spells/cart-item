!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).CartItem={})}(this,function(t){"use strict";class CartItem extends HTMLElement{static#t=new Map;static#e=null;#i="ready";#s=!1;#n=!1;#a={};#r=null;#o=null;static setTemplate(t,e){if("string"!=typeof t)throw new Error("Template name must be a string");if("function"!=typeof e)throw new Error("Template must be a function");CartItem.#t.set(t,e)}static setProcessingTemplate(t){if("function"!=typeof t)throw new Error("Processing template must be a function");CartItem.#e=t}static createAnimated(t,e){return new CartItem(t,e,{animate:!0})}static get observedAttributes(){return["state","key"]}attributeChangedCallback(t,e,i){e!==i&&"state"===t&&(this.#i=i||"ready")}constructor(t=null,e=null,i={}){super(),this.#r=t,this.#o=e;const s=i.animate||this.hasAttribute("animate-in");this.#i=t&&s?"appearing":this.getAttribute("state")||"ready",this.#a={click:this.#c.bind(this),change:this.#h.bind(this),transitionEnd:this.#m.bind(this)}}connectedCallback(){this.#r&&this.#l(),this.content=this.querySelector("cart-item-content"),this.processing=this.querySelector("cart-item-processing"),this.#d(),this.#u(),"appearing"===this.#i&&(this.setAttribute("state","appearing"),this.#n=!0,requestAnimationFrame(()=>{const t=this.scrollHeight;this.style.height=`${t}px`,requestAnimationFrame(()=>{this.setState("ready")})}))}disconnectedCallback(){this.#g()}#u(){this.addEventListener("click",this.#a.click),this.addEventListener("change",this.#a.change),this.addEventListener("quantity-modifier:change",this.#a.change),this.addEventListener("transitionend",this.#a.transitionEnd)}#g(){this.removeEventListener("click",this.#a.click),this.removeEventListener("change",this.#a.change),this.removeEventListener("quantity-modifier:change",this.#a.change),this.removeEventListener("transitionend",this.#a.transitionEnd)}get state(){return this.#i}get cartKey(){return this.getAttribute("key")}#c(t){t.target.closest("[data-action-remove-item]")&&(t.preventDefault(),this.#p())}#h(t){if("quantity-modifier:change"===t.type)return void this.#y(t.detail.value);const e=t.target.closest("[data-cart-quantity]");e&&this.#y(e.value)}#m(t){"height"===t.propertyName&&this.#s?(console.log("handle transition End - remove()"),this.remove()):"height"===t.propertyName&&this.#n&&(this.style.height="",this.#n=!1)}#p(){this.dispatchEvent(new CustomEvent("cart-item:remove",{bubbles:!0,detail:{cartKey:this.cartKey,element:this}}))}#y(t){this.dispatchEvent(new CustomEvent("cart-item:quantity-change",{bubbles:!0,detail:{cartKey:this.cartKey,quantity:parseInt(t),element:this}}))}#l(){if(console.log("cart-item - render ",this.#r),!this.#r||0===CartItem.#t.size)return void console.log("no item data or no template",this.#r,CartItem.#t);const t=this.#r.key||this.#r.id;t&&this.setAttribute("key",t);const e=this.#r.properties?._cartTemplate||"default",i=CartItem.#t.get(e)||CartItem.#t.get("default");if(!i)return void console.warn(`Cart item template '${e}' not found and no default template set`);const s=i(this.#r,this.#o),n=CartItem.#e?CartItem.#e():'<div class="cart-item-loader"></div>';this.innerHTML=`\n      <cart-item-content>\n        ${s}\n      </cart-item-content>\n      <cart-item-processing>\n        ${n}\n      </cart-item-processing>\n    `}setData(t,e=null){console.log("cart-item - setData",t),this.#r=t,e&&(this.#o=e),this.#l(),this.content=this.querySelector("cart-item-content"),this.processing=this.querySelector("cart-item-processing"),this.#d()}#d(){if(!this.#r)return;const t=this.querySelectorAll("[data-content-line-price]"),e=this.#f(this.#r.line_price||0);t.forEach(t=>{t.textContent=e})}#f(t){return"number"!=typeof t?"$0.00":`$${(t/100).toFixed(2)}`}get itemData(){return this.#r}setState(t){["ready","processing","destroying","appearing"].includes(t)&&this.setAttribute("state",t)}destroyYourself(){if(this.#s)return;console.log("cart-item: destroy Yourself"),this.#s=!0;const t=this.offsetHeight;console.log("initialHeight",t),this.setState("destroying"),requestAnimationFrame(()=>{this.style.height=`${t}px`;const e=getComputedStyle(this),i=e.getPropertyValue("--cart-item-destroying-duration")?.trim()||"400ms";this.style.transition=`height ${i} ease`,setTimeout(()=>{this.style.height="0px"},1),setTimeout(()=>{this.remove()},600)})}}class CartItemContent extends HTMLElement{constructor(){super()}}class CartItemProcessing extends HTMLElement{constructor(){super()}}customElements.get("cart-item")||customElements.define("cart-item",CartItem),customElements.get("cart-item-content")||customElements.define("cart-item-content",CartItemContent),customElements.get("cart-item-processing")||customElements.define("cart-item-processing",CartItemProcessing),t.CartItem=CartItem,t.CartItemContent=CartItemContent,t.CartItemProcessing=CartItemProcessing});
